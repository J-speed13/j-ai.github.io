<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J-AI | Creative Studio Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0b0f19;
            color: #e2e8f0;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 3px; }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-anim { animation: fadeIn 0.3s ease-out forwards; }

        @keyframes pulse-ring {
            0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .music-active .status-dot { animation: pulse-ring 2s infinite; background-color: #10b981; }

        /* Generated Image */
        .gen-image {
            border-radius: 0.5rem;
            border: 1px solid #3b82f6;
            margin-top: 0.75rem;
            width: 100%;
            max-width: 512px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease;
            background: #1e293b;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .gen-image img { width: 100%; height: auto; border-radius: 0.5rem; }
        .gen-image:hover { transform: scale(1.01); }

        /* Visualizer Bars */
        .visualizer { display: flex; align-items: flex-end; gap: 2px; height: 20px; }
        .bar { width: 4px; background: #3b82f6; animation: sound 0.5s infinite ease-in-out; }
        @keyframes sound { 0%, 100% { height: 20%; } 50% { height: 100%; } }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden selection:bg-cyan-500 selection:text-white">

    <!-- Header -->
    <header class="bg-slate-900/80 backdrop-blur border-b border-slate-700 p-4 shadow-lg z-20 flex items-center justify-between">
        <div class="flex items-center space-x-3">
            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-600 to-cyan-500 flex items-center justify-center shadow-[0_0_15px_rgba(6,182,212,0.5)]">
                <span class="font-mono font-bold text-xl text-white">J</span>
            </div>
            <div>
                <h1 class="font-bold text-lg tracking-wide text-white">J-AI <span class="text-xs text-cyan-400 font-normal">Studio Pro</span></h1>
                <div class="flex items-center space-x-2">
                    <span class="status-dot h-2 w-2 rounded-full bg-slate-500 transition-colors duration-300"></span>
                    <span id="system-status" class="text-[10px] text-slate-400 uppercase tracking-wider font-mono">System Ready</span>
                </div>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="stopMusic()" id="stop-btn" class="hidden text-red-400 hover:text-red-300 text-xs border border-red-900/50 bg-red-900/20 px-3 py-1.5 rounded transition-all">
                <i class="fas fa-stop mr-1"></i> STOP AUDIO
            </button>
            <button onclick="clearChat()" class="text-slate-400 hover:text-white transition-colors text-xs px-3 py-1.5 rounded hover:bg-slate-800">
                <i class="fas fa-trash-alt"></i>
            </button>
        </div>
    </header>

    <!-- Chat Area -->
    <main id="chat-container" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6 bg-[#0b0f19] relative">
        <div class="absolute inset-0 opacity-5 pointer-events-none bg-[linear-gradient(rgba(59,130,246,0.1)_1px,transparent_1px),linear-gradient(90deg,rgba(59,130,246,0.1)_1px,transparent_1px)] bg-[size:20px_20px]"></div>
        
        <!-- Intro Message -->
        <div class="flex items-start space-x-3 message-anim relative z-10">
            <div class="w-8 h-8 rounded bg-gradient-to-br from-indigo-600 to-cyan-500 flex-shrink-0 flex items-center justify-center text-xs font-bold text-white">J</div>
            <div class="bg-slate-800 border border-slate-700 rounded-2xl rounded-tl-none p-4 max-w-[85%] md:max-w-[70%] shadow-xl">
                <p class="text-sm leading-relaxed text-slate-200">
                    <strong class="text-cyan-400">Update Complete.</strong> I can now generate real images and synthesize full musical tracks.<br><br>
                    <span class="text-xs font-mono text-slate-400 uppercase">Capabilities:</span>
                    <ul class="mt-2 space-y-2 text-slate-300 text-sm">
                        <li class="flex items-center gap-2"><i class="fas fa-image text-purple-400"></i> "Draw a cyberpunk cat"</li>
                        <li class="flex items-center gap-2"><i class="fas fa-music text-green-400"></i> "Play Techno", "Play Ambient", "Play Drums"</li>
                        <li class="flex items-center gap-2"><i class="fas fa-pen text-yellow-400"></i> "Write an essay about AI"</li>
                    </ul>
                </p>
            </div>
        </div>
    </main>

    <!-- Typing Indicator -->
    <div id="typing-indicator" class="hidden px-14 pb-4">
        <div class="flex items-center space-x-1">
            <span class="w-1.5 h-1.5 bg-cyan-500 rounded-full dot"></span>
            <span class="w-1.5 h-1.5 bg-cyan-500 rounded-full dot"></span>
            <span class="w-1.5 h-1.5 bg-cyan-500 rounded-full dot"></span>
        </div>
    </div>

    <!-- Input Area -->
    <footer class="bg-slate-900 border-t border-slate-700 p-4 z-20">
        <form id="chat-form" class="max-w-4xl mx-auto relative flex items-center gap-3">
            <div class="relative flex-1">
                <input 
                    type="text" 
                    id="user-input" 
                    class="w-full bg-slate-950 text-white placeholder-slate-500 rounded-xl py-3.5 pl-5 pr-12 border border-slate-700 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 transition-all font-mono text-sm shadow-inner"
                    placeholder="Command: 'Draw a city' or 'Play Ambient'..." 
                    autocomplete="off"
                >
                <div class="absolute right-3 top-1/2 -translate-y-1/2 text-[10px] text-slate-600 font-mono">PRO_MODE</div>
            </div>
            <button 
                type="submit" 
                class="bg-cyan-600 hover:bg-cyan-500 text-white rounded-xl p-3.5 w-12 flex items-center justify-center transition-all shadow-[0_0_10px_rgba(6,182,212,0.3)] hover:shadow-[0_0_20px_rgba(6,182,212,0.5)]"
            >
                <i class="fas fa-arrow-right"></i>
            </button>
        </form>
    </footer>

    <script>
        // --- J-AI Logic Core ---

        const chatContainer = document.getElementById('chat-container');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const typingIndicator = document.getElementById('typing-indicator');
        const stopBtn = document.getElementById('stop-btn');
        const statusText = document.getElementById('system-status');
        const body = document.body;

        // State
        let audioCtx = null;
        let isPlaying = false;
        let intervals = [];

        // European Knowledge Base
        const europeData = {
            "albania": "Tirana", "andorra": "Andorra la Vella", "austria": "Vienna", "belarus": "Minsk", "belgium": "Brussels",
            "bosnia": "Sarajevo", "bulgaria": "Sofia", "croatia": "Zagreb", "cyprus": "Nicosia", "czechia": "Prague",
            "denmark": "Copenhagen", "estonia": "Tallinn", "finland": "Helsinki", "france": "Paris", "germany": "Berlin",
            "greece": "Athens", "hungary": "Budapest", "iceland": "Reykjavik", "ireland": "Dublin", "italy": "Rome",
            "kosovo": "Pristina", "latvia": "Riga", "liechtenstein": "Vaduz", "lithuania": "Vilnius", "luxembourg": "Luxembourg",
            "malta": "Valletta", "moldova": "Chisinau", "monaco": "Monaco", "montenegro": "Podgorica", "netherlands": "Amsterdam",
            "north macedonia": "Skopje", "norway": "Oslo", "poland": "Warsaw", "portugal": "Lisbon", "romania": "Bucharest",
            "russia": "Moscow", "san marino": "San Marino", "serbia": "Belgrade", "slovakia": "Bratislava", "slovenia": "Ljubljana",
            "spain": "Madrid", "sweden": "Stockholm", "switzerland": "Bern", "ukraine": "Kyiv", "united kingdom": "London", "vatican city": "Vatican City"
        };

        // Event Listeners
        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            handleUserMessage();
        });

        function handleUserMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            addMessage(text, 'user');
            userInput.value = '';
            showTyping(true);

            // Initialize Audio on interaction
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            setTimeout(async () => {
                const response = await processLogic(text);
                showTyping(false);
                
                if (response.type === 'image') {
                    addImageMessage(response.src, response.alt);
                } else if (response.type === 'music') {
                    addMessage(response.text, 'ai');
                    startMusicSequence(response.style);
                } else {
                    addMessage(response, 'ai');
                }
            }, 800);
        }

        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `flex items-start space-x-3 message-anim relative z-10 ${sender === 'user' ? 'flex-row-reverse space-x-reverse' : ''}`;

            const avatar = document.createElement('div');
            const isAI = sender === 'ai';
            
            avatar.className = `w-8 h-8 rounded flex-shrink-0 flex items-center justify-center text-xs font-bold ${
                isAI 
                ? 'bg-gradient-to-br from-indigo-600 to-cyan-500 text-white' 
                : 'bg-slate-700 text-slate-300'
            }`;
            avatar.innerText = isAI ? 'J' : 'U';

            const bubble = document.createElement('div');
            bubble.className = `p-4 max-w-[85%] md:max-w-[70%] shadow-lg text-sm leading-relaxed ${
                isAI
                ? 'bg-slate-800 border border-slate-700 rounded-2xl rounded-tl-none text-slate-200'
                : 'bg-cyan-700 text-white rounded-2xl rounded-tr-none'
            }`;

            if (isAI) {
                bubble.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong class="text-cyan-400">$1</strong>').replace(/\n/g, '<br>');
            } else {
                bubble.innerText = text;
            }

            div.appendChild(avatar);
            div.appendChild(bubble);
            chatContainer.appendChild(div);
            scrollToBottom();
        }

        function addImageMessage(src, alt) {
            const div = document.createElement('div');
            div.className = `flex items-start space-x-3 message-anim relative z-10`;
            
            const avatar = document.createElement('div');
            avatar.className = `w-8 h-8 rounded flex-shrink-0 flex items-center justify-center text-xs font-bold bg-gradient-to-br from-indigo-600 to-cyan-500 text-white`;
            avatar.innerText = 'J';

            const container = document.createElement('div');
            container.className = "bg-slate-800 border border-slate-700 rounded-2xl rounded-tl-none p-4 max-w-[85%] shadow-lg w-full md:w-auto";
            
            const text = document.createElement('p');
            text.className = "text-sm text-slate-200 mb-2";
            text.innerHTML = `Generating visual artifact for: <strong class="text-cyan-400">"${alt}"</strong>`;

            const imgContainer = document.createElement('div');
            imgContainer.className = "gen-image";
            
            // Image with loader
            imgContainer.innerHTML = `<i class="fas fa-circle-notch fa-spin text-cyan-500 text-2xl absolute"></i>`;
            
            const img = new Image();
            img.src = src;
            img.alt = alt;
            img.onload = () => {
                imgContainer.innerHTML = '';
                imgContainer.appendChild(img);
            };
            img.onerror = () => {
                imgContainer.innerHTML = `<span class="text-red-400 text-xs">Generation Protocol Failed.</span>`;
            };

            container.appendChild(text);
            container.appendChild(imgContainer);
            div.appendChild(avatar);
            div.appendChild(container);
            chatContainer.appendChild(div);
            scrollToBottom();
        }

        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTyping(show) {
            if (show) {
                typingIndicator.classList.remove('hidden');
                scrollToBottom();
            } else {
                typingIndicator.classList.add('hidden');
            }
        }

        function clearChat() {
            if(confirm("Purge memory banks?")) {
                chatContainer.innerHTML = '';
                addMessage("Memory purged. System rebooted.", 'ai');
            }
        }

        // --- ENHANCED AUDIO ENGINE (Synthesizer) ---

        function playTone(freq, type, duration, startTime, vol = 0.1) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = type;
            osc.frequency.setValueAtTime(freq, startTime);
            
            gain.gain.setValueAtTime(vol, startTime);
            gain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start(startTime);
            osc.stop(startTime + duration);
        }
        
        // New Pad synthesizer for ambient
        function playPad(freq, duration, startTime, vol = 0.05) {
             const osc = audioCtx.createOscillator();
             const gain = audioCtx.createGain();
             
             osc.type = 'triangle';
             osc.frequency.setValueAtTime(freq, startTime);
             
             // Slow attack and release
             gain.gain.setValueAtTime(0, startTime);
             gain.gain.linearRampToValueAtTime(vol, startTime + duration/2);
             gain.gain.linearRampToValueAtTime(0, startTime + duration);
             
             osc.connect(gain);
             gain.connect(audioCtx.destination);
             
             osc.start(startTime);
             osc.stop(startTime + duration);
        }

        function playNoise(duration, startTime, vol = 0.2) {
            const bufferSize = audioCtx.sampleRate * duration;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            
            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(vol, startTime);
            gain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
            
            noise.connect(gain);
            gain.connect(audioCtx.destination);
            noise.start(startTime);
        }

        function playKick(time) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.setValueAtTime(150, time);
            osc.frequency.exponentialRampToValueAtTime(0.01, time + 0.5);
            gain.gain.setValueAtTime(0.5, time);
            gain.gain.exponentialRampToValueAtTime(0.001, time + 0.5);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(time);
            osc.stop(time + 0.5);
        }

        function startMusicSequence(style = 'techno') {
            if (isPlaying) { stopMusic(); } // Reset if already playing
            isPlaying = true;
            body.classList.add('music-active');
            stopBtn.classList.remove('hidden');
            statusText.innerText = `AUDIO: ${style.toUpperCase()}`;
            statusText.className = "text-[10px] text-green-400 uppercase tracking-wider font-mono";

            // Default: Techno
            let tempo = 120;
            if (style === 'ambient') tempo = 60;
            if (style === 'dnb') tempo = 174;

            const secondsPerBeat = 60 / tempo;
            let bar = 0;

            // Loop Scheduler
            const scheduler = setInterval(() => {
                const now = audioCtx.currentTime;
                // Schedule next 4 beats (1 bar)
                
                if (style === 'techno') {
                    // KICK (4/4)
                    playKick(now); playKick(now + secondsPerBeat); playKick(now + secondsPerBeat * 2); playKick(now + secondsPerBeat * 3);
                    // SNARE (2 & 4)
                    playNoise(0.1, now + secondsPerBeat, 0.2); playNoise(0.1, now + secondsPerBeat * 3, 0.2);
                    // HATS (16ths)
                    for(let i=0; i<16; i++) { if (i % 4 !== 0) playNoise(0.05, now + (secondsPerBeat/4) * i, 0.05); }
                    // BASS
                    const note = [55, 55, 58, 53][bar % 4];
                    playTone(note, 'sawtooth', 0.2, now, 0.2); playTone(note, 'sawtooth', 0.2, now + 0.5 * secondsPerBeat, 0.2);
                    // LEAD
                    if(Math.random() > 0.3) playTone([220, 261, 329][Math.floor(Math.random()*3)], 'square', 0.1, now + secondsPerBeat * (Math.floor(Math.random()*4)), 0.05);
                } 
                else if (style === 'ambient') {
                    // PADS (Long, slow chords)
                    const roots = [220, 196, 174, 164]; // A3, G3, F3, E3
                    const root = roots[bar % roots.length];
                    playPad(root, secondsPerBeat * 4, now, 0.1);
                    playPad(root * 1.5, secondsPerBeat * 4, now, 0.05); // Fifth
                    // SPACE DRIPS (Random high pings)
                    if(Math.random() > 0.5) playTone(880 + Math.random()*400, 'sine', 0.5, now + Math.random()*3, 0.05);
                }
                else if (style === 'dnb') {
                    // KICK (Breakbeat: 1, 3.5)
                    playKick(now); 
                    playKick(now + secondsPerBeat * 2.5);
                    // SNARE (2, 4)
                    playNoise(0.1, now + secondsPerBeat, 0.25);
                    playNoise(0.1, now + secondsPerBeat * 3, 0.25);
                    // FAST HATS (8ths)
                    for(let i=0; i<8; i++) playNoise(0.04, now + (secondsPerBeat/2) * i, 0.06);
                    // SUB BASS (Long Sine)
                    const bass = [44, 44, 39, 49][bar % 4];
                    playTone(bass, 'sine', secondsPerBeat * 2, now, 0.4);
                }

                bar++;
            }, (secondsPerBeat * 4) * 1000);

            intervals.push(scheduler);
        }

        function stopMusic() {
            intervals.forEach(clearInterval);
            intervals = [];
            isPlaying = false;
            body.classList.remove('music-active');
            stopBtn.classList.add('hidden');
            statusText.innerText = "SYSTEM READY";
            statusText.className = "text-[10px] text-slate-400 uppercase tracking-wider font-mono";
        }


        // --- MAIN LOGIC PROCESSOR ---

        async function processLogic(input) {
            const lowerInput = input.toLowerCase();

            // 1. IMAGE GENERATION (REAL)
            if (lowerInput.includes("draw") || lowerInput.includes("image") || lowerInput.includes("paint") || lowerInput.includes("picture")) {
                const prompt = input.replace(/draw|an|image|of|paint|picture|make/gi, "").trim();
                const seed = Math.floor(Math.random() * 1000);
                const safePrompt = encodeURIComponent(prompt + " " + seed); 
                return { 
                    type: 'image', 
                    src: `https://image.pollinations.ai/prompt/${safePrompt}?width=512&height=300&nologo=true`, 
                    alt: prompt 
                };
            }

            // 2. MUSIC GENERATION (REAL)
            if (lowerInput.includes("music") || lowerInput.includes("song") || lowerInput.includes("play")) {
                let style = 'techno';
                let desc = "Cyber-Grid Sequence Alpha (120 BPM)";
                
                if (lowerInput.includes("ambient") || lowerInput.includes("chill") || lowerInput.includes("space")) {
                    style = 'ambient';
                    desc = "Void-Drift Atmosphere (60 BPM)";
                } else if (lowerInput.includes("drum") || lowerInput.includes("fast") || lowerInput.includes("dnb")) {
                    style = 'dnb';
                    desc = "Neural-Breakbeat (174 BPM)";
                }

                return { 
                    type: 'music',
                    style: style,
                    text: `**Initiating Audio Engine...**\nPlaying: *${desc}*\n\n<div class='visualizer mt-2'><div class='bar'></div><div class='bar' style='animation-delay:0.1s'></div><div class='bar' style='animation-delay:0.2s'></div><div class='bar' style='animation-delay:0.3s'></div><div class='bar' style='animation-delay:0.1s'></div></div>` 
                };
            }

            // 3. ESSAY
            if (lowerInput.includes("essay") || lowerInput.includes("write about")) {
                const topic = input.replace(/write|an|essay|about/gi, "").trim() || "The Future";
                return writeEssay(topic);
            }

            // 4. WEATHER
            if (lowerInput.includes("weather")) {
                let location = "London";
                for(let country in europeData) {
                    if(lowerInput.includes(country)) location = europeData[country];
                }
                const match = lowerInput.match(/weather in ([a-z\s]+)/i);
                if (match && match[1]) location = match[1].trim();

                try {
                    const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(location)}&count=1&language=en&format=json`);
                    const geoData = await geoRes.json();
                    if (!geoData.results) return `I couldn't locate **${location}**.`;
                    const { latitude, longitude, name, country } = geoData.results[0];
                    const wRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`);
                    const wData = await wRes.json();
                    return `**Weather Report:**\nLocation: **${name}, ${country}**\nTemp: **${wData.current_weather.temperature}°C**\nWind: **${wData.current_weather.windspeed} km/h**`;
                } catch (e) { return "Data link severed. Weather unavailable."; }
            }

            // 5. EUROPEAN DATA
            if (lowerInput.includes("europe")) {
                let list = "**European Database:**\n";
                let count = 0;
                for (let [c, cap] of Object.entries(europeData)) {
                    if(count < 10) list += `• **${c.charAt(0).toUpperCase() + c.slice(1)}**: ${cap}\n`;
                    count++;
                }
                list += "*(List truncated for display efficiency)*";
                return list;
            }

            // 6. GREETINGS / DEFAULT
            if (lowerInput.match(/^(hi|hello|hey)/)) return "Online. Ready to generate Art, Music, or Data.";

            return "Command not recognized in creative matrix. Try **'Draw a robot'**, **'Play Ambient'**, or **'Play Drums'**.";
        }

        function writeEssay(topic) {
            return `**Analysis: ${topic}**\n\nIn the modern era, **${topic}** serves as a critical focal point for understanding our trajectory. From a historical perspective, it has shaped civilizations, yet its future implications remain fluid.\n\nKey experts argue that **${topic}** is not merely a singular concept but a convergence of multiple systemic factors. Whether we analyze it through a technological or sociological lens, the pattern remains clear: evolution is inevitable.\n\nIn conclusion, to master **${topic}** is to master a fundamental aspect of the human condition.`;
        }

    </script>
</body>
</html>